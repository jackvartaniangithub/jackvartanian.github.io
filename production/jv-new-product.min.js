(function () {

    try {

        let NewProduct = {
            init: () => {
                NewProduct.wppProduct();
                NewProduct.colecaoInfo();
                NewProduct.apareceBarra();
                NewProduct.highlightFlag();
                NewProduct.sizeguideFunctions();
                NewProduct.sizeSelector();

                if (vtxctx["categoryId"] != 1000030) {
                    NewProduct.montaEstrutura();
                    NewProduct.btnCincoOff();
                }
            },
            windowOnload: () => {
                NewProduct.getDiscountPrice();
            },
            ajaxStop: () => {},
            wppProduct: () => {
                if ($('#product-info-whatsapp-a') != null) {
                    var productName = $('.productName')[0].innerHTML.toString();
                    if ($('.productDescriptionShort').length > 0) {
                        var productShortDesc = $('.productDescriptionShort')[0].innerHTML.toString();
                    } else {
                        var productShortDesc = '';
                    }
                    var productUrl = window.location.toString();
                    var wppLinkEl = $('#product-info-whatsapp-a');
                    var wppMsg = 'https://api.whatsapp.com/send?phone=5511961870214&text=OlÃ¡Â¡, gostaria de saber mais informaÃ§Ãµes ' +
                        'sobre o produto ' + productName + ' ' + productShortDesc + ' (' + productUrl + '), obrigado!';
                    wppLinkEl.attr("href", wppMsg);
                }
            },
            montaEstrutura: () => {
                fixPrice = (price) => {
                    var np = '';
                    p = price.toFixed(2).replace('.', ',');
                    if (p.split(',')[0].length == 4) {
                        np = 'R$ ' + p[0] + '.' + p.substring(1, p.length);
                    } else if (p.split(',')[0].length == 5) {
                        np = 'R$ ' + p.substring(0, 2) + '.' + p.substring(2, p.length)
                    } else {
                        np = 'R$ ' + p;
                    }
                    return np;
                }
        
                priceTotal = $('.priceTotal');
        
        
                for (i = 0; i < priceTotal.length; i++) {
        
                    var preco = priceTotal[i].innerText.split(" ")[0] + " " + priceTotal[i].innerText.split(" ")[1];
        
        
                    price = parseInt(preco.split(" ")[1].replace('.', ""))
                    if (!priceTotal[i].innerText.toLowerCase().includes('junto')) {
        
                        priceDisc = price * .95
                        disc = price - priceDisc
        
                        priceTotal[i].innerHTML = '<span class="priceTotal-DE">' + 'De: ' + preco + '</span>' + '<span class="priceTotal">' + 'Por: ' + fixPrice(priceDisc) + '</span>' + '<span class="priceTotal">' + 'Comprando junto vocÃª economiza: ' + fixPrice(disc) + '</span>'
        
                    } else {
                        priceDisc = price
                        disc = price - priceDisc
                        priceTotal[i].innerHTML = '<span class="priceTotal">' + 'Por: ' + fixPrice(priceDisc) + '</span>' + '<span class="priceTotal">' + 'Comprando junto vocÃª economiza: ' + priceTotal[i].innerText.split(" ")[priceTotal[i].innerText.split(" ").length - 1] + '</span>'
        
        
                    }
        
                }
        
                $('hr.buy-together').before('<p style="text-transform: initial;text-align: center;font-size: 14px;color: gray;margin-bottom: 10px">O desconto aparecerÃ¡ antes de finalizar o pedido</p>');
        
        
                col = $('.x-specification .Colecao.value-field')[0].innerText;
                if (col == 'Pop Chain') {
                    hr = 'https://br.jackvartanian.com/joias/Pop%20Chain?O=OrderByTopSaleDESC&PS=18&map=c,specificationFilter_18'
                    $('hr.buy-together').before('<a class="bt-link" href="' + hr + '"><p style="text-transform: initial;text-align: center;font-size: 14px;color: black;margin-bottom: 10px;text-decoration: underline;text-transform: uppercase;font-weight: 600;">Comprando 2 ou mais joias da coleÃ§Ã£o vocÃª ganha 5% off. Confira aqui mais joias Â»</p></a>');
        
                } else if (col == 'Chain' || col == 'Pink Chain' || col == 'Pink Chain') {
                    hr = 'https://br.jackvartanian.com/colecoes/chains/'
                    $('hr.buy-together').before('<a class="bt-link" href="' + hr + '"><p style="text-transform: initial;text-align: center;font-size: 14px;color: black;margin-bottom: 10px;text-decoration: underline;text-transform: uppercase;font-weight: 600;">Comprando 2 ou mais joias da coleÃ§Ã£o vocÃª ganha 5% off. Confira aqui mais joias Â»</p></a>');
                } else if (col == 'POP!') {
                    hr = 'https://br.jackvartanian.com/joias/POP!?O=OrderByTopSaleDESC&PS=18&map=c,specificationFilter_18'
                    $('hr.buy-together').before('<a class="bt-link" href="' + hr + '"><p style="text-transform: initial;text-align: center;font-size: 14px;color: black;margin-bottom: 10px;text-decoration: underline;text-transform: uppercase;font-weight: 600;">Comprando 2 ou mais joias da coleÃ§Ã£o vocÃª ganha 5% off. Confira aqui mais joias Â»</p></a>');
                } else {
                    for (i = 0; i < priceTotal.length; i++) {
        
                        linkBuyTogether = $('.comprar-junto a')[i]
                        linkBuyTogether.href += '&utm_campaign=bt5jv&utm_source=bt5jv';
                    }
        
                }
            },
            btnCincoOff: () => {
                if ($('.n1__product__buyTogether #divTitulo').length > 0) {
                    $('#scroll5Off').css('display', 'block');
        
                    $('#scroll5Off').click(function (e) {
                        e.preventDefault();
        
                        $('html, body').animate({
                            scrollTop: $('#divCompreJunto').offset().top
                        }, 500);
                    });
                }
            },
            colecaoInfo: () => {
                $.getJSON("/arquivos/000-JML-jsonColecoes.js", function (colecaoJson) {

                    try {
                        if (vtxctx.departmentName != 'Adega') {
                            try {
                                nomeColecao = $('.x-specification .value-field.Colecao')[0].innerText;
                            } catch (error) {
                                nomeColecao = '';
                                console.log(error)
                            }
        
                            try {
        
                                textoColecao = colecaoJson[nomeColecao]["desc"];
                                bannerColecao = colecaoJson[nomeColecao]["bannerTop"];
                                linkColecao = colecaoJson[nomeColecao]["link"];
                            } catch (error) {
                                console.log(error)
                            }
                        }
                        if (nomeColecao == 'Chains') {
                            nomeColecao = 'Chain'
                        }
                        if (nomeColecao == 'LIFE.STYLE') {
                            nomeColecao = 'Life.Style'
                        }
                        if (nomeColecao == 'POP KIDS') {
                            nomeColecao = 'POP! Kids'
                        }
                        if (nomeColecao == 'JV MAN II') {
                            nomeColecao = 'JV Man II'
                        }
        
                        //function bannerPaginaProduto() {
                        //   html = '<div id="bannerColecaoProduto">' + '<div class="textoBannerColecao">' + '<p>' + nomeColecao + '</p>' + '<span>' + textoColecao + '</span>' + '<br>' + '<br>' + '<a href="' + linkColecao + '">' + "Clique aqui e confira a coleÃƒÂ§ÃƒÂ£o >>" + '</a>' + '</div>' + '<div class="imgBannerColecao">' + '<img src="' + bannerColecao + '">' + '</div>' + '</div>';
                        //   $('#Scolecao').append(html);
                        //}
        
                        colecaoComLink = '<h3>ColeÃ§Ã£o</h3><a style="font-size: 14px; cursor:pointer; font-weight:400; color: #393939;" href="' + linkColecao + '">' + nomeColecao + '</a>'
                        $('.conteudo .colecao').append(colecaoComLink);
                    } catch (error) {
                        console.log(error);
                    }
        
                })
            },
            apareceBarra: () => {
                //SOBE BARRA PAGINA PRODUTO
                setTimeout(() => {


                    var priceAltura = $('.product-main-info-price').height();
                    try {
                        var limitHeight = $('.product-main-info-shippingdesc-botttom-line1').offset().top;
                    } catch (e) {
                        var limitHeight = 0;
                    }


                    window.onscroll = function () {

                        if ($(document).width() <= 1024) {

                            if (this.scrollY >= limitHeight) {
                                $('.product-main-info-price').addClass('product-main-info-price_scroll');
                                $('#help-icon-box').addClass('wpp-product-page');
                                $('.buy-button').addClass('buy-button_scroll');
                                $('.plugin-preco').addClass('plugin-preco_scroll');
                                $('.substituto').css('height', priceAltura + 'px');
                                $('.substituto').show();
                            }

                            if (this.scrollY <= limitHeight - 1) {
                                $('.product-main-info-price').removeClass('product-main-info-price_scroll');
                                $('#help-icon-box').removeClass('wpp-product-page');
                                $('.buy-button').removeClass('buy-button_scroll');
                                $('.plugin-preco').removeClass('plugin-preco_scroll');
                                $('.substituto').css('height', '0px');
                                $('.substituto').hide();
                            }
                        }
                    }
                }, 3300);
            },
            highlightFlag: () => {
                flags = $('.product-main .flags-produto p');
                flagCount = 0;
                for (i = 0; i < flags.length; i++) {
                    classnam = flags[i].innerText;

                    if (classnam.includes('Exclusivo online') || classnam.includes('Best seller') || classnam.includes('LanÃ§amento')) {
                        if (flagCount == 0) {
                            $('.product-main .productName').before('<div class="flags-highlight"></div>');

                        }

                        flagCount++;
                        if (flagCount > 1) {
                            $('div.flags-highlight').append('<p class="tick">|</p>');
                        }
                        $('div.flags-highlight').append('<p class="' + flags[i].className + '">' + classnam + '</p>');

                    }

                }
            },
            sizeguideFunctions: () => {
                //desktop  
                $(".itens-sizeguide li").on("click", function () {
                    $(".itens-sizeguide li").removeClass('selected');
                    $(this).addClass('selected')

                    $('.tabs-content>div').removeClass('showSize');
                    $($('.tabs-content>div')[$(this).index()]).addClass('showSize');
                });

                //mobile
                $(".tab-link-mobile").on("click", function () {
                    $(this).next().toggleClass('showSize');
                    $(this).toggleClass('rotate');
                });



                //Abre o guia
                $(".abreGuia").on("click", function () {
                    if ($('body').width() < 840) {
                        $(".itens-sizeguide li").removeClass('selected');
                        $('.tabs-content>div').removeClass('showSize');
                    }
                    $("#box-tamanhos").fadeIn();
                    $(".sombraGuia").addClass("mostrarSombra");
                });

                //Fecha o guia
                $(".fechaGuia, .sombraGuia").on("click", function () {
                    $("#box-tamanhos").fadeOut();
                    $(".sombraGuia").removeClass("mostrarSombra");
                });

                //Clique aqui
                $(".aqui").on("click", function () {
                    $('.tabs-content>div').removeClass('showSize');
                    $("#instrucao-medida").addClass("showSize");

                    $(".itens-sizeguide li").removeClass('selected');
                    $(".item-infoMedida").addClass('selected');
                });
            },
            sizeSelector: () => {
                var skuList = $('.selecao-sku-guia .select.skuList select')
                for (i = 0; i < skuList.length; i++) {
                    if ($('.selecao-sku-guia .select.skuList #espec_' + i + '_opcao_0 option')[0].innerText == "") {
                        $('.selecao-sku-guia .select.skuList #espec_' + i + '_opcao_0 option')[0].innerText = $('.selecao-sku-guia .specification')[i].innerText;
                    }
                }


                $('.select.skuList select').click((e) => {
                    classSkuList = e.target.parentElement.className.replaceAll(' ', '.')
                    $('.' + classSkuList).toggleClass('dropActive')
                })
                $('.tam').append("<ul></ul>")

                $.map($('.selecao-sku-guia .select.skuList select option'), function (option) {
                    $('.tam ul').append("<li>" + option.value + "</li>")
                });
            },
            getDiscountPrice: () => {
                skuString = $('#___rc-p-sku-ids')[0].value
                skuInfo = skuString.substring(0, skuString.length)
                commaIndex = skuString.indexOf(',', 0)
                if (commaIndex != -1) {
                    skuInfo = skuString.substring(0, commaIndex)
                }
                priceInt = getSkuData(skuInfo).listPrice * 0.9
                if (getSkuData(skuInfo).listPrice != getSkuData(skuInfo).price) {
                    priceInt = getSkuData(skuInfo).price * 0.95
                }
                priceFormatted = Intl.NumberFormat('PT-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2 }).format(Math.round(priceInt))
                $('.msg-30off')[0].innerHTML = `OU <b>${priceFormatted}</b> NO BOLETO, PIX OU TRANSFERÊNCIA`
            }
        };

        // Instanciando a funcao
        $(document).ready(NewProduct.init);
        let windowLoad = function () {
            NewProduct.windowOnload();
        };
        $(window).load(windowLoad);
        $(document).ajaxStop(NewProduct.ajaxStop);
        
    } catch (e) {
        console.log("Erro na instância do [NewProduct]: ", e);
    }

})();
